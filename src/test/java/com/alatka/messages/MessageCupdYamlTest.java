package com.alatka.messages;

import com.alatka.messages.definition.IsoYamlMessageDefinitionBuilder;
import com.alatka.messages.holder.MessageHolder;
import com.alatka.messages.message.MessageBuilder;
import com.alatka.messages.util.BytesUtil;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

@DisplayName("银联数据8583报文")
public class MessageCupdYamlTest {

    @BeforeAll
    public static void beforeAll() {
        new IsoYamlMessageDefinitionBuilder().build();
    }

    private void doTest(String hex, String key) {
        MessageHolder holder = MessageBuilder.init(key).unpack(hex);
        System.out.println(holder);
        byte[] pack = MessageBuilder.init(key).pack(holder);
        Assertions.assertEquals(BytesUtil.bytesToHex(pack), hex.toUpperCase());

        MessageHolder holder1 = MessageBuilder.init(key).unpack(pack);
        Assertions.assertEquals(holder1, holder);
    }

    @Test
    @DisplayName("header")
    public void test01() {
        String hex = "2901303530383030303030303030303030303030303030303030303000000000000000000000000000";
        String key = "iso:cupd:common:header";
        this.doTest(hex, key);
    }

    @Test
    @DisplayName("还款请求报文")
    public void test02() {
        String hex = "30323030F238448188E080100000000017100060313636323833303130333030303030303139343730303030303030303030303039393030303432343133353235333030303133373133353235333034323436303134303131303030383635313931313030303836353139313130303234303432343133353235333030393939303033303030303030303030303030303030B1BED0D0B5E7BBB0D2F8D0D0D0C5D3C3BFA8BBB9BFEE202020202020202020202020202020202020313536303135202020202020202030392020202020303836353139313130303139363233313033393931393031303932383233333136363238333031303330303030303031393035385349303533011336323331303339393139303130393238323333021EC7C7D4B0D4B02020202020202020202020202020202020202020202020203031302020202020202020203130313231383332202039393930303330393741443039322020202020202020202020202020202020202020333137313130303130303139CCECBDF2C5A9B4E5C9CCD2B5D2F8D0D0B9C9B7DDD3D0CFDEB9ABCBBE2020202020202020202020202020202020202020202020202020202020202020";
        String key = "iso:cupd:common:payload";
        this.doTest(hex, key);
    }

    @Test
    @DisplayName("还款应答报文")
    public void test03() {
        String hex = "30323130F23E40918AC084000000000016000041313636323833303130333030303030303139343730303030303030303030303039393030303432343133353235333030303133373133353235333034323430303030303832343630313430304430303030303030303038363531393131303030383635313931313030323430343234313335323533303030303939393030333030303030303030303030303030303135363034303330303131353644303030303032323038393932333030323135364330303030303431383839393230383635313931313030313936323331303339393139303130393238323333313636323833303130333030303030303139303138313833322020393939303033C7C7D4B0D4B03632323133443238";
        String key = "iso:cupd:common:payload";
        this.doTest(hex, key);
    }

    @Test
    @DisplayName("贷记卡免密消费请求")
    public void test04() {
        String hex = "30323030F238448198E080140000002011100060313636323538313930363230303030303339303030303030303030303030303036363636303432343134313432353030303134303134313432353034323436303133303132303030383635313931313030303836353139313130303030303234303432343134313432353030393938383031303030303030303030303030303030202020202020202020202020202020202020202020202020202020202020202020202020202020203135363031352020202020202020313520202020203031324441543030303034574C5A4639303836353139313130303035355349303530011039303033333130303030313730303031021ED6A7B8B6B1A6B2E2CAD4BBA7202020202020202020202020202020202020303332202020202020202020312020202020202020202020202020202020202020202030313231383938202039393838303130393741443039322020202020202020202020202020202020202020393030333331303030303137D6A7B8B6B1A6A3A8D6D0B9FAA3A9CDF8C2E7BCBCCAF5D3D0CFDEB9ABCBBE202020202020202020202020202020202020202020202020202020202020";
        String key = "iso:cupd:common:payload";
        this.doTest(hex, key);
    }

    @Test
    public void test99() {
        String hex = "5349";
        System.out.println(new String(BytesUtil.hexToBytes(hex)));
        System.out.println(0x1E);
    }

}
